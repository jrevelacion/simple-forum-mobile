import React, { useState, useEffect } from 'react';\nimport {\n  View,\n  Text,\n  FlatList,\n  TextInput,\n  TouchableOpacity,\n  StyleSheet,\n  Alert,\n  ScrollView,\n} from 'react-native';\nimport { useLocalSearchParams, useRouter } from 'expo-router';\nimport { posts, comments, likes } from '../../api';\n\nconst PostDetailScreen = () => {\n  const router = useRouter();\n  const { id } = useLocalSearchParams();\n  const [post, setPost] = useState(null);\n  const [postComments, setPostComments] = useState([]);\n  const [loading, setLoading] = useState(true);\n  const [commentText, setCommentText] = useState('');\n  const [submittingComment, setSubmittingComment] = useState(false);\n  const [isLiked, setIsLiked] = useState(false);\n\n  useEffect(() => {\n    fetchPost();\n  }, [id]);\n\n  const fetchPost = async () => {\n    try {\n      const response = await posts.getById(id);\n      setPost(response.data);\n      setPostComments(response.data.comments || []);\n      \n      // Check if liked\n      try {\n        const likeResponse = await likes.check(id);\n        setIsLiked(likeResponse.data.liked);\n      } catch (error) {\n        setIsLiked(false);\n      }\n    } catch (error) {\n      Alert.alert('Error', 'Failed to load post');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleAddComment = async () => {\n    if (!commentText.trim()) {\n      Alert.alert('Error', 'Please enter a comment');\n      return;\n    }\n\n    setSubmittingComment(true);\n    try {\n      await comments.add(id, commentText);\n      setCommentText('');\n      fetchPost();\n    } catch (error) {\n      Alert.alert('Error', 'Failed to add comment');\n    } finally {\n      setSubmittingComment(false);\n    }\n  };\n\n  const handleLike = async () => {\n    try {\n      if (isLiked) {\n        await likes.remove(id);\n      } else {\n        await likes.add(id);\n      }\n      setIsLiked(!isLiked);\n      fetchPost();\n    } catch (error) {\n      Alert.alert('Error', 'Failed to like post');\n    }\n  };\n\n  const renderComment = ({ item }) => (\n    <View style={styles.commentCard}>\n      <View style={styles.commentHeader}>\n        <Text style={styles.commentUsername}>{item.username}</Text>\n        <Text style={styles.commentDate}>{new Date(item.created_at).toLocaleDateString()}</Text>\n      </View>\n      <Text style={styles.commentContent}>{item.content}</Text>\n    </View>\n  );\n\n  if (loading) {\n    return (\n      <View style={styles.container}>\n        <Text style={styles.loadingText}>Loading...</Text>\n      </View>\n    );\n  }\n\n  if (!post) {\n    return (\n      <View style={styles.container}>\n        <Text style={styles.errorText}>Post not found</Text>\n      </View>\n    );\n  }\n\n  return (\n    <View style={styles.container}>\n      <View style={styles.header}>\n        <TouchableOpacity onPress={() => router.back()}>\n          <Text style={styles.backButton}>‚Üê Back</Text>\n        </TouchableOpacity>\n        <Text style={styles.headerTitle}>Post</Text>\n        <View style={{ width: 40 }} />\n      </View>\n\n      <FlatList\n        data={postComments}\n        renderItem={renderComment}\n        keyExtractor={item => item.id.toString()}\n        ListHeaderComponent={\n          <View style={styles.postContainer}>\n            <View style={styles.postHeader}>\n              <Text style={styles.username}>{post.username}</Text>\n              <Text style={styles.date}>{new Date(post.created_at).toLocaleDateString()}</Text>\n            </View>\n            <Text style={styles.title}>{post.title}</Text>\n            <Text style={styles.content}>{post.content}</Text>\n            <View style={styles.postFooter}>\n              <TouchableOpacity onPress={handleLike}>\n                <Text style={[styles.likeText, isLiked && styles.liked]}>\n                  {isLiked ? '‚ù§Ô∏è' : 'ü§ç'} {post.like_count}\n                </Text>\n              </TouchableOpacity>\n              <Text style={styles.commentCount}>üí¨ {postComments.length}</Text>\n            </View>\n          </View>\n        }\n        ListHeaderComponentStyle={styles.listHeader}\n      />\n\n      <View style={styles.commentInputContainer}>\n        <TextInput\n          style={styles.commentInput}\n          placeholder=\"Add a comment...\"\n          value={commentText}\n          onChangeText={setCommentText}\n          editable={!submittingComment}\n          multiline\n        />\n        <TouchableOpacity\n          style={[styles.sendButton, submittingComment && styles.sendButtonDisabled]}\n          onPress={handleAddComment}\n          disabled={submittingComment}\n        >\n          <Text style={styles.sendButtonText}>Send</Text>\n        </TouchableOpacity>\n      </View>\n    </View>\n  );\n};\n\nconst styles = StyleSheet.create({\n  container: {\n    flex: 1,\n    backgroundColor: '#f0f4f8',\n  },\n  header: {\n    backgroundColor: '#1a73e8',\n    padding: 15,\n    paddingTop: 40,\n    flexDirection: 'row',\n    justifyContent: 'space-between',\n    alignItems: 'center',\n  },\n  backButton: {\n    color: '#fff',\n    fontSize: 16,\n    fontWeight: 'bold',\n  },\n  headerTitle: {\n    fontSize: 20,\n    fontWeight: 'bold',\n    color: '#fff',\n  },\n  listHeader: {\n    padding: 0,\n  },\n  postContainer: {\n    backgroundColor: '#fff',\n    margin: 10,\n    borderRadius: 8,\n    padding: 15,\n    marginBottom: 20,\n  },\n  postHeader: {\n    flexDirection: 'row',\n    justifyContent: 'space-between',\n    marginBottom: 10,\n  },\n  username: {\n    fontWeight: 'bold',\n    color: '#1a73e8',\n    fontSize: 14,\n  },\n  date: {\n    color: '#999',\n    fontSize: 12,\n  },\n  title: {\n    fontSize: 18,\n    fontWeight: 'bold',\n    color: '#333',\n    marginBottom: 10,\n  },\n  content: {\n    fontSize: 14,\n    color: '#666',\n    marginBottom: 15,\n    lineHeight: 22,\n  },\n  postFooter: {\n    flexDirection: 'row',\n    justifyContent: 'space-between',\n    paddingTop: 10,\n    borderTopWidth: 1,\n    borderTopColor: '#eee',\n  },\n  likeText: {\n    color: '#999',\n    fontSize: 14,\n  },\n  liked: {\n    color: '#e74c3c',\n  },\n  commentCount: {\n    color: '#999',\n    fontSize: 14,\n  },\n  commentCard: {\n    backgroundColor: '#fff',\n    marginHorizontal: 10,\n    marginVertical: 5,\n    borderRadius: 8,\n    padding: 12,\n    borderLeftWidth: 3,\n    borderLeftColor: '#1a73e8',\n  },\n  commentHeader: {\n    flexDirection: 'row',\n    justifyContent: 'space-between',\n    marginBottom: 8,\n  },\n  commentUsername: {\n    fontWeight: 'bold',\n    color: '#1a73e8',\n    fontSize: 13,\n  },\n  commentDate: {\n    color: '#999',\n    fontSize: 11,\n  },\n  commentContent: {\n    fontSize: 13,\n    color: '#666',\n    lineHeight: 18,\n  },\n  commentInputContainer: {\n    flexDirection: 'row',\n    padding: 10,\n    backgroundColor: '#fff',\n    borderTopWidth: 1,\n    borderTopColor: '#eee',\n  },\n  commentInput: {\n    flex: 1,\n    backgroundColor: '#f0f4f8',\n    borderRadius: 20,\n    paddingHorizontal: 15,\n    paddingVertical: 10,\n    marginRight: 10,\n    fontSize: 14,\n    maxHeight: 100,\n  },\n  sendButton: {\n    backgroundColor: '#1a73e8',\n    borderRadius: 20,\n    paddingHorizontal: 20,\n    justifyContent: 'center',\n  },\n  sendButtonDisabled: {\n    opacity: 0.6,\n  },\n  sendButtonText: {\n    color: '#fff',\n    fontWeight: 'bold',\n    fontSize: 14,\n  },\n  loadingText: {\n    fontSize: 16,\n    color: '#999',\n    textAlign: 'center',\n    marginTop: 50,\n  },\n  errorText: {\n    fontSize: 16,\n    color: '#e74c3c',\n    textAlign: 'center',\n    marginTop: 50,\n  },\n});\n\nexport default PostDetailScreen;\n
