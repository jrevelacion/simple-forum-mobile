import React, { useState, useEffect } from 'react';\nimport {\n  View,\n  Text,\n  FlatList,\n  TouchableOpacity,\n  StyleSheet,\n  Alert,\n  ScrollView,\n} from 'react-native';\nimport { useLocalSearchParams, useRouter } from 'expo-router';\nimport { users, posts } from '../../api';\nimport { useAuth } from '../../AuthContext';\n\nconst ProfileScreen = () => {\n  const router = useRouter();\n  const { id } = useLocalSearchParams();\n  const { user: currentUser, logout } = useAuth();\n  const [profile, setProfile] = useState(null);\n  const [userPosts, setUserPosts] = useState([]);\n  const [loading, setLoading] = useState(true);\n\n  useEffect(() => {\n    fetchProfile();\n  }, [id]);\n\n  const fetchProfile = async () => {\n    try {\n      const profileResponse = await users.getProfile(id);\n      setProfile(profileResponse.data);\n      \n      // Fetch all posts and filter by user\n      const postsResponse = await posts.getAll();\n      const filtered = postsResponse.data.filter(p => p.user_id === parseInt(id));\n      setUserPosts(filtered);\n    } catch (error) {\n      Alert.alert('Error', 'Failed to load profile');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleLogout = async () => {\n    Alert.alert('Logout', 'Are you sure?', [\n      { text: 'Cancel', onPress: () => {} },\n      {\n        text: 'Logout',\n        onPress: async () => {\n          await logout();\n          router.replace('/auth/login');\n        },\n      },\n    ]);\n  };\n\n  const renderPost = ({ item }) => (\n    <TouchableOpacity\n      style={styles.postCard}\n      onPress={() => router.push(`/(app)/post/${item.id}`)}\n    >\n      <Text style={styles.postTitle}>{item.title}</Text>\n      <Text style={styles.postContent} numberOfLines={2}>{item.content}</Text>\n      <Text style={styles.postDate}>{new Date(item.created_at).toLocaleDateString()}</Text>\n    </TouchableOpacity>\n  );\n\n  if (loading) {\n    return (\n      <View style={styles.container}>\n        <Text style={styles.loadingText}>Loading...</Text>\n      </View>\n    );\n  }\n\n  if (!profile) {\n    return (\n      <View style={styles.container}>\n        <Text style={styles.errorText}>Profile not found</Text>\n      </View>\n    );\n  }\n\n  const isOwnProfile = currentUser?.id === parseInt(id);\n\n  return (\n    <View style={styles.container}>\n      <View style={styles.header}>\n        <TouchableOpacity onPress={() => router.back()}>\n          <Text style={styles.backButton}>‚Üê Back</Text>\n        </TouchableOpacity>\n        <Text style={styles.headerTitle}>Profile</Text>\n        {isOwnProfile && (\n          <TouchableOpacity onPress={handleLogout}>\n            <Text style={styles.logoutButton}>Logout</Text>\n          </TouchableOpacity>\n        )}\n      </View>\n\n      <FlatList\n        data={userPosts}\n        renderItem={renderPost}\n        keyExtractor={item => item.id.toString()}\n        ListHeaderComponent={\n          <View style={styles.profileCard}>\n            <View style={styles.avatarContainer}>\n              <Text style={styles.avatar}>üë§</Text>\n            </View>\n            <Text style={styles.username}>{profile.username}</Text>\n            <Text style={styles.bio}>{profile.bio || 'No bio yet'}</Text>\n            <Text style={styles.joinDate}>Joined {new Date(profile.created_at).toLocaleDateString()}</Text>\n            <Text style={styles.postsCount}>{userPosts.length} posts</Text>\n          </View>\n        }\n        ListHeaderComponentStyle={styles.listHeader}\n        ListEmptyComponent={\n          <View style={styles.emptyContainer}>\n            <Text style={styles.emptyText}>No posts yet</Text>\n          </View>\n        }\n      />\n    </View>\n  );\n};\n\nconst styles = StyleSheet.create({\n  container: {\n    flex: 1,\n    backgroundColor: '#f0f4f8',\n  },\n  header: {\n    backgroundColor: '#1a73e8',\n    padding: 15,\n    paddingTop: 40,\n    flexDirection: 'row',\n    justifyContent: 'space-between',\n    alignItems: 'center',\n  },\n  backButton: {\n    color: '#fff',\n    fontSize: 16,\n    fontWeight: 'bold',\n  },\n  headerTitle: {\n    fontSize: 20,\n    fontWeight: 'bold',\n    color: '#fff',\n  },\n  logoutButton: {\n    color: '#fff',\n    fontSize: 14,\n    fontWeight: 'bold',\n  },\n  listHeader: {\n    padding: 0,\n  },\n  profileCard: {\n    backgroundColor: '#fff',\n    margin: 15,\n    borderRadius: 12,\n    padding: 20,\n    alignItems: 'center',\n    shadowColor: '#000',\n    shadowOffset: { width: 0, height: 2 },\n    shadowOpacity: 0.1,\n    shadowRadius: 4,\n    elevation: 3,\n  },\n  avatarContainer: {\n    width: 80,\n    height: 80,\n    borderRadius: 40,\n    backgroundColor: '#f0f4f8',\n    justifyContent: 'center',\n    alignItems: 'center',\n    marginBottom: 15,\n  },\n  avatar: {\n    fontSize: 40,\n  },\n  username: {\n    fontSize: 24,\n    fontWeight: 'bold',\n    color: '#333',\n    marginBottom: 10,\n  },\n  bio: {\n    fontSize: 14,\n    color: '#666',\n    textAlign: 'center',\n    marginBottom: 10,\n    fontStyle: 'italic',\n  },\n  joinDate: {\n    fontSize: 12,\n    color: '#999',\n    marginBottom: 5,\n  },\n  postsCount: {\n    fontSize: 14,\n    fontWeight: 'bold',\n    color: '#1a73e8',\n  },\n  postCard: {\n    backgroundColor: '#fff',\n    marginHorizontal: 15,\n    marginVertical: 8,\n    borderRadius: 8,\n    padding: 15,\n    borderLeftWidth: 4,\n    borderLeftColor: '#1a73e8',\n  },\n  postTitle: {\n    fontSize: 15,\n    fontWeight: 'bold',\n    color: '#333',\n    marginBottom: 8,\n  },\n  postContent: {\n    fontSize: 13,\n    color: '#666',\n    marginBottom: 8,\n    lineHeight: 18,\n  },\n  postDate: {\n    fontSize: 11,\n    color: '#999',\n  },\n  emptyContainer: {\n    paddingVertical: 40,\n    alignItems: 'center',\n  },\n  emptyText: {\n    fontSize: 14,\n    color: '#999',\n  },\n  loadingText: {\n    fontSize: 16,\n    color: '#999',\n    textAlign: 'center',\n    marginTop: 50,\n  },\n  errorText: {\n    fontSize: 16,\n    color: '#e74c3c',\n    textAlign: 'center',\n    marginTop: 50,\n  },\n});\n\nexport default ProfileScreen;\n
