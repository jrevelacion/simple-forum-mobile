import React, { useState, useEffect } from 'react';\nimport {\n  View,\n  Text,\n  FlatList,\n  TouchableOpacity,\n  StyleSheet,\n  RefreshControl,\n  Alert,\n} from 'react-native';\nimport { useRouter } from 'expo-router';\nimport { posts, likes } from '../api';\nimport { useAuth } from '../AuthContext';\n\nconst HomeScreen = () => {\n  const router = useRouter();\n  const { user, logout } = useAuth();\n  const [allPosts, setAllPosts] = useState([]);\n  const [loading, setLoading] = useState(true);\n  const [refreshing, setRefreshing] = useState(false);\n  const [likedPosts, setLikedPosts] = useState({});\n\n  useEffect(() => {\n    fetchPosts();\n  }, []);\n\n  const fetchPosts = async () => {\n    try {\n      const response = await posts.getAll();\n      setAllPosts(response.data);\n      \n      // Check which posts are liked\n      const liked = {};\n      for (const post of response.data) {\n        try {\n          const likeResponse = await likes.check(post.id);\n          liked[post.id] = likeResponse.data.liked;\n        } catch (error) {\n          liked[post.id] = false;\n        }\n      }\n      setLikedPosts(liked);\n    } catch (error) {\n      Alert.alert('Error', 'Failed to load posts');\n    } finally {\n      setLoading(false);\n      setRefreshing(false);\n    }\n  };\n\n  const handleRefresh = () => {\n    setRefreshing(true);\n    fetchPosts();\n  };\n\n  const handleLike = async (postId) => {\n    try {\n      if (likedPosts[postId]) {\n        await likes.remove(postId);\n      } else {\n        await likes.add(postId);\n      }\n      setLikedPosts(prev => ({\n        ...prev,\n        [postId]: !prev[postId],\n      }));\n    } catch (error) {\n      Alert.alert('Error', 'Failed to like post');\n    }\n  };\n\n  const renderPost = ({ item }) => (\n    <TouchableOpacity\n      style={styles.postCard}\n      onPress={() => router.push(`/(app)/post/${item.id}`)}\n    >\n      <View style={styles.postHeader}>\n        <Text style={styles.username}>{item.username}</Text>\n        <Text style={styles.date}>{new Date(item.created_at).toLocaleDateString()}</Text>\n      </View>\n      <Text style={styles.title}>{item.title}</Text>\n      <Text style={styles.content} numberOfLines={3}>{item.content}</Text>\n      <View style={styles.postFooter}>\n        <TouchableOpacity\n          style={styles.likeButton}\n          onPress={() => handleLike(item.id)}\n        >\n          <Text style={[styles.likeText, likedPosts[item.id] && styles.liked]}>‚ù§Ô∏è {item.like_count}</Text>\n        </TouchableOpacity>\n        <Text style={styles.commentCount}>üí¨ {item.comment_count}</Text>\n      </View>\n    </TouchableOpacity>\n  );\n\n  return (\n    <View style={styles.container}>\n      <View style={styles.header}>\n        <Text style={styles.headerTitle}>Forum</Text>\n        <TouchableOpacity\n          style={styles.profileButton}\n          onPress={() => router.push(`/(app)/profile/${user?.id}`)}\n        >\n          <Text style={styles.profileButtonText}>üë§</Text>\n        </TouchableOpacity>\n      </View>\n\n      <FlatList\n        data={allPosts}\n        renderItem={renderPost}\n        keyExtractor={item => item.id.toString()}\n        refreshControl={<RefreshControl refreshing={refreshing} onRefresh={handleRefresh} />}\n        ListEmptyComponent={\n          !loading && (\n            <View style={styles.emptyContainer}>\n              <Text style={styles.emptyText}>No posts yet. Be the first to post!</Text>\n            </View>\n          )\n        }\n      />\n\n      <TouchableOpacity\n        style={styles.fab}\n        onPress={() => router.push('/(app)/create-post')}\n      >\n        <Text style={styles.fabText}>+</Text>\n      </TouchableOpacity>\n    </View>\n  );\n};\n\nconst styles = StyleSheet.create({\n  container: {\n    flex: 1,\n    backgroundColor: '#f0f4f8',\n  },\n  header: {\n    backgroundColor: '#1a73e8',\n    padding: 20,\n    paddingTop: 40,\n    flexDirection: 'row',\n    justifyContent: 'space-between',\n    alignItems: 'center',\n  },\n  headerTitle: {\n    fontSize: 28,\n    fontWeight: 'bold',\n    color: '#fff',\n  },\n  profileButton: {\n    width: 40,\n    height: 40,\n    borderRadius: 20,\n    backgroundColor: 'rgba(255,255,255,0.2)',\n    justifyContent: 'center',\n    alignItems: 'center',\n  },\n  profileButtonText: {\n    fontSize: 20,\n  },\n  postCard: {\n    backgroundColor: '#fff',\n    marginHorizontal: 10,\n    marginVertical: 8,\n    borderRadius: 8,\n    padding: 15,\n    shadowColor: '#000',\n    shadowOffset: { width: 0, height: 2 },\n    shadowOpacity: 0.1,\n    shadowRadius: 4,\n    elevation: 3,\n  },\n  postHeader: {\n    flexDirection: 'row',\n    justifyContent: 'space-between',\n    marginBottom: 10,\n  },\n  username: {\n    fontWeight: 'bold',\n    color: '#1a73e8',\n    fontSize: 14,\n  },\n  date: {\n    color: '#999',\n    fontSize: 12,\n  },\n  title: {\n    fontSize: 16,\n    fontWeight: 'bold',\n    color: '#333',\n    marginBottom: 8,\n  },\n  content: {\n    fontSize: 14,\n    color: '#666',\n    marginBottom: 12,\n    lineHeight: 20,\n  },\n  postFooter: {\n    flexDirection: 'row',\n    justifyContent: 'space-between',\n    paddingTop: 10,\n    borderTopWidth: 1,\n    borderTopColor: '#eee',\n  },\n  likeButton: {\n    padding: 5,\n  },\n  likeText: {\n    color: '#999',\n    fontSize: 14,\n  },\n  liked: {\n    color: '#e74c3c',\n  },\n  commentCount: {\n    color: '#999',\n    fontSize: 14,\n  },\n  fab: {\n    position: 'absolute',\n    bottom: 20,\n    right: 20,\n    width: 60,\n    height: 60,\n    borderRadius: 30,\n    backgroundColor: '#1a73e8',\n    justifyContent: 'center',\n    alignItems: 'center',\n    shadowColor: '#000',\n    shadowOffset: { width: 0, height: 4 },\n    shadowOpacity: 0.3,\n    shadowRadius: 8,\n    elevation: 8,\n  },\n  fabText: {\n    fontSize: 32,\n    color: '#fff',\n    fontWeight: 'bold',\n  },\n  emptyContainer: {\n    flex: 1,\n    justifyContent: 'center',\n    alignItems: 'center',\n    paddingVertical: 50,\n  },\n  emptyText: {\n    fontSize: 16,\n    color: '#999',\n  },\n});\n\nexport default HomeScreen;\n
